# ì—”í‹°í‹°ì™€ ê³„ì¸µ êµ¬ì¡°

## ğŸ“š ê°œìš”

ì´ ê³¼ì œì—ì„œëŠ” **ì—”í‹°í‹°(Entity)**ë¥¼ ë‹¤ë£¨ëŠ” ì½”ë“œì™€ ê·¸ë ‡ì§€ ì•Šì€ ì½”ë“œë¥¼ êµ¬ë¶„í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.

---

## ğŸ·ï¸ ì—”í‹°í‹°(Entity)ë€?

**ì—”í‹°í‹°**ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë„ë©”ì¸ì˜ í•µì‹¬ ë°ì´í„° ëª¨ë¸ì…ë‹ˆë‹¤.
ì´ ì‡¼í•‘ëª° ê³¼ì œì—ì„œì˜ ì—”í‹°í‹°:

| ì—”í‹°í‹° | ì„¤ëª… | íƒ€ì… |
|--------|------|------|
| **Product** | ìƒí’ˆ | `{ id, name, price, stock, discounts }` |
| **CartItem** | ì¥ë°”êµ¬ë‹ˆ ì•„ì´í…œ | `{ product, quantity }` |
| **Coupon** | ì¿ í° | `{ name, code, discountType, discountValue }` |

### ì—”í‹°í‹° vs ë¹„ì—”í‹°í‹°

```typescript
// ğŸ·ï¸ ì—”í‹°í‹° ìƒíƒœ (ë„ë©”ì¸ ë°ì´í„°)
const [products, setProducts] = useState<Product[]>([]);
const [cart, setCart] = useState<CartItem[]>([]);
const [coupons, setCoupons] = useState<Coupon[]>([]);
const [selectedCoupon, setSelectedCoupon] = useState<Coupon | null>(null);

// ğŸ¨ ë¹„ì—”í‹°í‹° ìƒíƒœ (UI ìƒíƒœ)
const [isAdmin, setIsAdmin] = useState(false);
const [showProductForm, setShowProductForm] = useState(false);
const [showCouponForm, setShowCouponForm] = useState(false);
const [activeTab, setActiveTab] = useState<'products' | 'coupons'>('products');
const [searchTerm, setSearchTerm] = useState('');
const [notifications, setNotifications] = useState<Notification[]>([]);
const [editingProduct, setEditingProduct] = useState<string | null>(null);
```

---

## ğŸ“ ê³„ì¸µ êµ¬ì¡°: Entities â†’ Features â†’ UI

ì½”ë“œë¥¼ ì„¸ ê³„ì¸µìœ¼ë¡œ ë‚˜ëˆ„ì–´ ì˜ì¡´ì„± ë°©í–¥ì„ ê´€ë¦¬í•©ë‹ˆë‹¤:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UI Layer                      â”‚
â”‚         (Components, Pages)                      â”‚
â”‚                     â†“                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                Features Layer                    â”‚
â”‚         (Hooks, Context, State)                  â”‚
â”‚                     â†“                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                Entities Layer                    â”‚
â”‚     (Models, Pure Functions, Types)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì˜ì¡´ì„± ê·œì¹™

- **ìƒìœ„ ê³„ì¸µì€ í•˜ìœ„ ê³„ì¸µì— ì˜ì¡´í•  ìˆ˜ ìˆìŒ**
- **í•˜ìœ„ ê³„ì¸µì€ ìƒìœ„ ê³„ì¸µì— ì˜ì¡´í•˜ë©´ ì•ˆ ë¨**
- EntitiesëŠ” ì–´ë–¤ ê²ƒì—ë„ ì˜ì¡´í•˜ì§€ ì•ŠìŒ (ê°€ì¥ ì•ˆì •ì )

---

## ğŸ—‚ï¸ í´ë” êµ¬ì¡°

```
src/basic/
â”œâ”€â”€ models/                 # ğŸ·ï¸ Entities Layer
â”‚   â”œâ”€â”€ cart.ts             # ì¥ë°”êµ¬ë‹ˆ ìˆœìˆ˜ í•¨ìˆ˜
â”‚   â”œâ”€â”€ product.ts          # ìƒí’ˆ ìˆœìˆ˜ í•¨ìˆ˜
â”‚   â”œâ”€â”€ coupon.ts           # ì¿ í° ìˆœìˆ˜ í•¨ìˆ˜
â”‚   â””â”€â”€ discount.ts         # í• ì¸ ê³„ì‚° ìˆœìˆ˜ í•¨ìˆ˜
â”‚
â”œâ”€â”€ hooks/                  # âš¡ Features Layer
â”‚   â”œâ”€â”€ useCart.ts          # ì¥ë°”êµ¬ë‹ˆ ìƒíƒœ ê´€ë¦¬
â”‚   â”œâ”€â”€ useProducts.ts      # ìƒí’ˆ ìƒíƒœ ê´€ë¦¬
â”‚   â””â”€â”€ useCoupons.ts       # ì¿ í° ìƒíƒœ ê´€ë¦¬
â”‚
â”œâ”€â”€ utils/                  # ğŸ”§ Shared Utilities
â”‚   â”œâ”€â”€ formatters.ts       # í¬ë§·íŒ… ìœ í‹¸
â”‚   â””â”€â”€ hooks/
â”‚       â”œâ”€â”€ useDebounce.ts  # ë””ë°”ìš´ìŠ¤ í›…
â”‚       â””â”€â”€ useLocalStorage.ts
â”‚
â”œâ”€â”€ components/             # ğŸ¨ UI Layer
â”‚   â”œâ”€â”€ Cart/               # ì¥ë°”êµ¬ë‹ˆ ê´€ë ¨ ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ Product/            # ìƒí’ˆ ê´€ë ¨ ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ Admin/              # ê´€ë¦¬ì ê´€ë ¨ ì»´í¬ë„ŒíŠ¸
â”‚   â””â”€â”€ ui/                 # ë²”ìš© UI ì»´í¬ë„ŒíŠ¸
â”‚
â”œâ”€â”€ types.ts                # íƒ€ì… ì •ì˜
â””â”€â”€ App.tsx                 # ë£¨íŠ¸ ì»´í¬ë„ŒíŠ¸
```

---

## ğŸ“¦ ê° ê³„ì¸µë³„ ì—­í• 

### 1. Entities Layer (models/)

**íŠ¹ì§•:**
- ìˆœìˆ˜ í•¨ìˆ˜ë§Œ í¬í•¨
- Reactì— ì˜ì¡´í•˜ì§€ ì•ŠìŒ
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ í•µì‹¬
- í…ŒìŠ¤íŠ¸í•˜ê¸° ê°€ì¥ ì‰¬ì›€

```typescript
// models/cart.ts
import { CartItem, Product, Coupon } from '../types';

// ìˆœìˆ˜ í•¨ìˆ˜: ì…ë ¥ë§Œìœ¼ë¡œ ì¶œë ¥ ê²°ì •
export function calculateItemTotal(item: CartItem): number {
  const discount = getMaxApplicableDiscount(item);
  return Math.round(item.product.price * item.quantity * (1 - discount));
}

export function getMaxApplicableDiscount(item: CartItem): number {
  const { discounts } = item.product;
  const { quantity } = item;
  
  return discounts.reduce((maxDiscount, discount) => {
    return quantity >= discount.quantity && discount.rate > maxDiscount 
      ? discount.rate 
      : maxDiscount;
  }, 0);
}

export function calculateCartTotal(
  cart: CartItem[], 
  selectedCoupon: Coupon | null
): { totalBeforeDiscount: number; totalAfterDiscount: number } {
  const totalBeforeDiscount = cart.reduce(
    (sum, item) => sum + item.product.price * item.quantity, 
    0
  );
  
  let totalAfterDiscount = cart.reduce(
    (sum, item) => sum + calculateItemTotal(item), 
    0
  );
  
  if (selectedCoupon) {
    if (selectedCoupon.discountType === 'amount') {
      totalAfterDiscount = Math.max(0, totalAfterDiscount - selectedCoupon.discountValue);
    } else {
      totalAfterDiscount = Math.round(
        totalAfterDiscount * (1 - selectedCoupon.discountValue / 100)
      );
    }
  }
  
  return {
    totalBeforeDiscount: Math.round(totalBeforeDiscount),
    totalAfterDiscount: Math.round(totalAfterDiscount)
  };
}

export function addItemToCart(cart: CartItem[], product: Product): CartItem[] {
  const existingItem = cart.find(item => item.product.id === product.id);
  
  if (existingItem) {
    return cart.map(item =>
      item.product.id === product.id
        ? { ...item, quantity: item.quantity + 1 }
        : item
    );
  }
  
  return [...cart, { product, quantity: 1 }];
}

export function removeItemFromCart(cart: CartItem[], productId: string): CartItem[] {
  return cart.filter(item => item.product.id !== productId);
}

export function updateCartItemQuantity(
  cart: CartItem[], 
  productId: string, 
  quantity: number
): CartItem[] {
  if (quantity <= 0) {
    return removeItemFromCart(cart, productId);
  }
  
  return cart.map(item =>
    item.product.id === productId
      ? { ...item, quantity }
      : item
  );
}

export function getRemainingStock(product: Product, cart: CartItem[]): number {
  const cartItem = cart.find(item => item.product.id === product.id);
  return product.stock - (cartItem?.quantity || 0);
}
```

### 2. Features Layer (hooks/)

**íŠ¹ì§•:**
- ìƒíƒœ ê´€ë¦¬ ë‹´ë‹¹
- Entitiesì˜ ìˆœìˆ˜ í•¨ìˆ˜ ì‚¬ìš©
- React Hook í™œìš©
- localStorage, API ë“± ë¶€ì‘ìš© ì²˜ë¦¬

```typescript
// hooks/useCart.ts
import { useState, useCallback, useEffect } from 'react';
import { CartItem, Product, Coupon } from '../types';
import * as cartModel from '../models/cart';

export function useCart() {
  // ìƒíƒœ ê´€ë¦¬ (localStorage ì—°ë™)
  const [cart, setCart] = useState<CartItem[]>(() => {
    const saved = localStorage.getItem('cart');
    return saved ? JSON.parse(saved) : [];
  });
  
  const [selectedCoupon, setSelectedCoupon] = useState<Coupon | null>(null);
  
  // localStorage ë™ê¸°í™”
  useEffect(() => {
    if (cart.length > 0) {
      localStorage.setItem('cart', JSON.stringify(cart));
    } else {
      localStorage.removeItem('cart');
    }
  }, [cart]);
  
  // ì•¡ì…˜ë“¤: ìˆœìˆ˜ í•¨ìˆ˜ë¥¼ í™œìš©í•˜ì—¬ ìƒíƒœ ì—…ë°ì´íŠ¸
  const addToCart = useCallback((product: Product): { success: boolean; message: string } => {
    const remainingStock = cartModel.getRemainingStock(product, cart);
    
    if (remainingStock <= 0) {
      return { success: false, message: 'ì¬ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!' };
    }
    
    if (remainingStock === 1) {
      // ì¬ê³ ê°€ 1ê°œ ë‚¨ì•˜ì„ ë•Œ
    }
    
    setCart(prevCart => cartModel.addItemToCart(prevCart, product));
    return { success: true, message: 'ì¥ë°”êµ¬ë‹ˆì— ë‹´ì•˜ìŠµë‹ˆë‹¤' };
  }, [cart]);
  
  const removeFromCart = useCallback((productId: string) => {
    setCart(prevCart => cartModel.removeItemFromCart(prevCart, productId));
  }, []);
  
  const updateQuantity = useCallback((productId: string, quantity: number, maxStock: number) => {
    if (quantity > maxStock) {
      return { success: false, message: `ì¬ê³ ëŠ” ${maxStock}ê°œê¹Œì§€ë§Œ ìˆìŠµë‹ˆë‹¤.` };
    }
    
    setCart(prevCart => cartModel.updateCartItemQuantity(prevCart, productId, quantity));
    return { success: true, message: '' };
  }, []);
  
  const applyCoupon = useCallback((coupon: Coupon) => {
    setSelectedCoupon(coupon);
  }, []);
  
  const clearCoupon = useCallback(() => {
    setSelectedCoupon(null);
  }, []);
  
  const clearCart = useCallback(() => {
    setCart([]);
    setSelectedCoupon(null);
  }, []);
  
  // ê³„ì‚°ëœ ê°’ë“¤
  const totals = cartModel.calculateCartTotal(cart, selectedCoupon);
  const totalItemCount = cart.reduce((sum, item) => sum + item.quantity, 0);
  
  // í—¬í¼ í•¨ìˆ˜
  const getRemainingStock = useCallback((product: Product) => {
    return cartModel.getRemainingStock(product, cart);
  }, [cart]);
  
  return {
    // ìƒíƒœ
    cart,
    selectedCoupon,
    totals,
    totalItemCount,
    
    // ì•¡ì…˜
    addToCart,
    removeFromCart,
    updateQuantity,
    applyCoupon,
    clearCoupon,
    clearCart,
    
    // í—¬í¼
    getRemainingStock,
  };
}
```

### 3. UI Layer (components/)

**íŠ¹ì§•:**
- í™”ë©´ ë Œë”ë§ ë‹´ë‹¹
- Hooksì—ì„œ ìƒíƒœì™€ ì•¡ì…˜ ê°€ì ¸ì˜´
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ìµœì†Œí™”
- ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì»´í¬ë„ŒíŠ¸

```typescript
// components/Cart/CartItem.tsx
import { CartItem as CartItemType } from '../../types';
import * as cartModel from '../../models/cart';

interface Props {
  item: CartItemType;
  onUpdateQuantity: (quantity: number) => void;
  onRemove: () => void;
}

export function CartItemCard({ item, onUpdateQuantity, onRemove }: Props) {
  // ìˆœìˆ˜ í•¨ìˆ˜ë¡œ ê³„ì‚°
  const itemTotal = cartModel.calculateItemTotal(item);
  const originalPrice = item.product.price * item.quantity;
  const hasDiscount = itemTotal < originalPrice;
  const discountRate = hasDiscount 
    ? Math.round((1 - itemTotal / originalPrice) * 100) 
    : 0;
  
  return (
    <div className="border-b pb-3">
      <div className="flex justify-between items-start mb-2">
        <h4 className="text-sm font-medium">{item.product.name}</h4>
        <button onClick={onRemove} className="text-gray-400 hover:text-red-500">
          âœ•
        </button>
      </div>
      
      <div className="flex items-center justify-between">
        <div className="flex items-center">
          <button 
            onClick={() => onUpdateQuantity(item.quantity - 1)}
            className="w-6 h-6 border rounded"
          >
            âˆ’
          </button>
          <span className="mx-3">{item.quantity}</span>
          <button 
            onClick={() => onUpdateQuantity(item.quantity + 1)}
            className="w-6 h-6 border rounded"
          >
            +
          </button>
        </div>
        
        <div className="text-right">
          {hasDiscount && (
            <span className="text-xs text-red-500 block">-{discountRate}%</span>
          )}
          <p className="font-medium">{itemTotal.toLocaleString()}ì›</p>
        </div>
      </div>
    </div>
  );
}
```

---

## ğŸ”— ì—”í‹°í‹°ë³„ ì½”ë“œ ë¶„ë¥˜

### Product ì—”í‹°í‹°

| ê³„ì¸µ | íŒŒì¼ | ë‚´ìš© |
|------|------|------|
| Entities | `models/product.ts` | ìƒí’ˆ ê´€ë ¨ ìˆœìˆ˜ í•¨ìˆ˜ |
| Features | `hooks/useProducts.ts` | ìƒí’ˆ ìƒíƒœ ê´€ë¦¬ í›… |
| UI | `components/Product/` | ìƒí’ˆ ê´€ë ¨ ì»´í¬ë„ŒíŠ¸ |

### Cart ì—”í‹°í‹°

| ê³„ì¸µ | íŒŒì¼ | ë‚´ìš© |
|------|------|------|
| Entities | `models/cart.ts` | ì¥ë°”êµ¬ë‹ˆ ê³„ì‚° ìˆœìˆ˜ í•¨ìˆ˜ |
| Features | `hooks/useCart.ts` | ì¥ë°”êµ¬ë‹ˆ ìƒíƒœ ê´€ë¦¬ í›… |
| UI | `components/Cart/` | ì¥ë°”êµ¬ë‹ˆ ê´€ë ¨ ì»´í¬ë„ŒíŠ¸ |

### Coupon ì—”í‹°í‹°

| ê³„ì¸µ | íŒŒì¼ | ë‚´ìš© |
|------|------|------|
| Entities | `models/coupon.ts` | ì¿ í° ê´€ë ¨ ìˆœìˆ˜ í•¨ìˆ˜ |
| Features | `hooks/useCoupons.ts` | ì¿ í° ìƒíƒœ ê´€ë¦¬ í›… |
| UI | `components/Admin/` | ì¿ í° ê´€ë¦¬ ì»´í¬ë„ŒíŠ¸ |

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

### ì—”í‹°í‹° ë¶„ë¦¬ í™•ì¸

- [ ] ê° ì—”í‹°í‹°ë³„ë¡œ ìˆœìˆ˜ í•¨ìˆ˜ê°€ `models/`ì— ë¶„ë¦¬ë˜ì–´ ìˆëŠ”ê°€?
- [ ] ìˆœìˆ˜ í•¨ìˆ˜ê°€ ì™¸ë¶€ ìƒíƒœì— ì˜ì¡´í•˜ì§€ ì•ŠëŠ”ê°€?
- [ ] ê° ì—”í‹°í‹°ë³„ë¡œ ì „ìš© Hookì´ ìˆëŠ”ê°€?

### ê³„ì¸µ ì˜ì¡´ì„± í™•ì¸

- [ ] `models/`ê°€ Reactì— ì˜ì¡´í•˜ì§€ ì•ŠëŠ”ê°€?
- [ ] `models/`ê°€ `hooks/`ë‚˜ `components/`ë¥¼ importí•˜ì§€ ì•ŠëŠ”ê°€?
- [ ] `hooks/`ê°€ `components/`ë¥¼ importí•˜ì§€ ì•ŠëŠ”ê°€?
- [ ] ì»´í¬ë„ŒíŠ¸ê°€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì§ì ‘ í¬í•¨í•˜ì§€ ì•ŠëŠ”ê°€?

### UI/ë„ë©”ì¸ ë¶„ë¦¬ í™•ì¸

- [ ] UI ìƒíƒœ(`showForm`, `isLoading` ë“±)ê°€ ë„ë©”ì¸ í›…ê³¼ ë¶„ë¦¬ë˜ì–´ ìˆëŠ”ê°€?
- [ ] í¬ë§·íŒ… í•¨ìˆ˜ê°€ `utils/formatters.ts`ì— ë¶„ë¦¬ë˜ì–´ ìˆëŠ”ê°€?

