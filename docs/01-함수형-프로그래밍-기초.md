# í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë° ê¸°ì´ˆ

## ğŸ“š ê°œìš”

ì´ ê³¼ì œì˜ í•µì‹¬ì€ **ì•¡ì…˜(Action)**ê³¼ **ê³„ì‚°(Calculation)**ì„ ë¶„ë¦¬í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë°ì—ì„œëŠ” ì½”ë“œë¥¼ ì„¸ ê°€ì§€ë¡œ ë¶„ë¥˜í•©ë‹ˆë‹¤:

| ë¶„ë¥˜ | ì„¤ëª… | ì˜ˆì‹œ |
|------|------|------|
| **ë°ì´í„° (Data)** | ì´ë²¤íŠ¸ì— ëŒ€í•œ ì‚¬ì‹¤ | `{ id: 'p1', name: 'ìƒí’ˆ1', price: 10000 }` |
| **ê³„ì‚° (Calculation)** | ì…ë ¥ìœ¼ë¡œ ì¶œë ¥ì„ ê³„ì‚° | `calculateTotal(cart)` |
| **ì•¡ì…˜ (Action)** | ì™¸ë¶€ ì„¸ê³„ì— ì˜í–¥ì„ ì£¼ê±°ë‚˜ ë°›ìŒ | `saveToLocalStorage()`, `fetchProducts()` |

---

## ğŸ§® ê³„ì‚° (Calculation) - ìˆœìˆ˜ í•¨ìˆ˜

### íŠ¹ì§•
- **ê°™ì€ ì…ë ¥ â†’ í•­ìƒ ê°™ì€ ì¶œë ¥** (ì°¸ì¡° íˆ¬ëª…ì„±)
- **ë¶€ì‘ìš©(Side Effect)ì´ ì—†ìŒ**
- ì™¸ë¶€ ìƒíƒœë¥¼ ì½ê±°ë‚˜ ë³€ê²½í•˜ì§€ ì•ŠìŒ
- í…ŒìŠ¤íŠ¸í•˜ê¸° ì‰¬ì›€
- ì–¸ì œ ì–´ë””ì„œ í˜¸ì¶œí•´ë„ ê²°ê³¼ê°€ ë™ì¼

### ìˆœìˆ˜ í•¨ìˆ˜ ì˜ˆì‹œ

```typescript
// âœ… ì¢‹ì€ ì˜ˆ: ìˆœìˆ˜ í•¨ìˆ˜
function calculateItemTotal(item: CartItem): number {
  const { price } = item.product;
  const { quantity } = item;
  const discount = getMaxApplicableDiscount(item);
  
  return Math.round(price * quantity * (1 - discount));
}

// âœ… ì¢‹ì€ ì˜ˆ: ëª¨ë“  í•„ìš”í•œ ë°ì´í„°ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë°›ìŒ
function calculateCartTotal(
  cart: CartItem[], 
  selectedCoupon: Coupon | null
): { totalBeforeDiscount: number; totalAfterDiscount: number } {
  let totalBeforeDiscount = 0;
  let totalAfterDiscount = 0;

  cart.forEach(item => {
    totalBeforeDiscount += item.product.price * item.quantity;
    totalAfterDiscount += calculateItemTotal(item);
  });

  if (selectedCoupon) {
    if (selectedCoupon.discountType === 'amount') {
      totalAfterDiscount = Math.max(0, totalAfterDiscount - selectedCoupon.discountValue);
    } else {
      totalAfterDiscount = Math.round(totalAfterDiscount * (1 - selectedCoupon.discountValue / 100));
    }
  }

  return { totalBeforeDiscount, totalAfterDiscount };
}

// âœ… ì¢‹ì€ ì˜ˆ: ìƒˆ ë°°ì—´ì„ ë°˜í™˜ (ì›ë³¸ ë¶ˆë³€)
function addItemToCart(cart: CartItem[], product: Product): CartItem[] {
  const existingItem = cart.find(item => item.product.id === product.id);
  
  if (existingItem) {
    return cart.map(item =>
      item.product.id === product.id
        ? { ...item, quantity: item.quantity + 1 }
        : item
    );
  }
  
  return [...cart, { product, quantity: 1 }];
}
```

### ìˆœìˆ˜í•˜ì§€ ì•Šì€ í•¨ìˆ˜ (í”¼í•´ì•¼ í•  íŒ¨í„´)

```typescript
// âŒ ë‚˜ìœ ì˜ˆ: ì™¸ë¶€ ë³€ìˆ˜ ì°¸ì¡°
let globalCart: CartItem[] = [];

function calculateTotal() {
  // globalCartë¥¼ ì§ì ‘ ì°¸ì¡° - ìˆœìˆ˜í•˜ì§€ ì•ŠìŒ
  return globalCart.reduce((sum, item) => sum + item.product.price, 0);
}

// âŒ ë‚˜ìœ ì˜ˆ: ì›ë³¸ ë°°ì—´ ìˆ˜ì •
function addItem(cart: CartItem[], product: Product) {
  cart.push({ product, quantity: 1 }); // ì›ë³¸ ìˆ˜ì •!
  return cart;
}

// âŒ ë‚˜ìœ ì˜ˆ: ë¶€ì‘ìš© í¬í•¨
function calculateAndSave(cart: CartItem[]) {
  const total = cart.reduce((sum, item) => sum + item.product.price, 0);
  localStorage.setItem('total', String(total)); // ë¶€ì‘ìš©!
  return total;
}
```

---

## âš¡ ì•¡ì…˜ (Action)

### íŠ¹ì§•
- ì™¸ë¶€ ì„¸ê³„ì™€ ìƒí˜¸ì‘ìš©
- **ì‹¤í–‰ ì‹œì **ê³¼ **ì‹¤í–‰ íšŸìˆ˜**ê°€ ì¤‘ìš”
- í˜¸ì¶œí•  ë•Œë§ˆë‹¤ ê²°ê³¼ê°€ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ
- í…ŒìŠ¤íŠ¸í•˜ê¸° ì–´ë ¤ì›€ (ëª¨í‚¹ í•„ìš”)

### ì•¡ì…˜ì˜ ì¢…ë¥˜

```typescript
// 1. ìƒíƒœ ë³€ê²½
setCart([...cart, newItem]);
setProducts(prev => [...prev, product]);

// 2. ì™¸ë¶€ ì €ì¥ì†Œ ì ‘ê·¼
localStorage.setItem('cart', JSON.stringify(cart));
const saved = localStorage.getItem('cart');

// 3. API í˜¸ì¶œ
await fetch('/api/products');
await axios.post('/api/orders', orderData);

// 4. íƒ€ì´ë¨¸
setTimeout(() => {}, 1000);
setInterval(() => {}, 1000);

// 5. ëœë¤ ê°’ ìƒì„±
const id = Math.random().toString();
const id = Date.now().toString();

// 6. í˜„ì¬ ì‹œê°„
const now = new Date();

// 7. ì½˜ì†” ì¶œë ¥
console.log('debug');
```

---

## ğŸ”„ ì•¡ì…˜ì—ì„œ ê³„ì‚° ì¶”ì¶œí•˜ê¸°

í˜„ì¬ ê³¼ì œì˜ ì›ë³¸ ì½”ë“œì—ì„œ ì•¡ì…˜ê³¼ ê³„ì‚°ì´ ì„ì—¬ìˆëŠ” ì˜ˆì‹œ:

### Before: ì•¡ì…˜ê³¼ ê³„ì‚°ì´ í˜¼í•©

```typescript
// App.tsx ë‚´ë¶€ - ì•¡ì…˜ê³¼ ê³„ì‚°ì´ ì„ì—¬ìˆìŒ
const addToCart = useCallback((product: Product) => {
  // ê³„ì‚°: ì¬ê³  í™•ì¸
  const remainingStock = getRemainingStock(product);
  
  if (remainingStock <= 0) {
    // ì•¡ì…˜: ì•Œë¦¼
    addNotification('ì¬ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!', 'error');
    return;
  }

  // ì•¡ì…˜: ìƒíƒœ ë³€ê²½
  setCart(prevCart => {
    // ê³„ì‚°: ìƒˆ ì¹´íŠ¸ ìƒì„±
    const existingItem = prevCart.find(item => item.product.id === product.id);
    
    if (existingItem) {
      return prevCart.map(item =>
        item.product.id === product.id
          ? { ...item, quantity: item.quantity + 1 }
          : item
      );
    }
    
    return [...prevCart, { product, quantity: 1 }];
  });
  
  // ì•¡ì…˜: ì•Œë¦¼
  addNotification('ì¥ë°”êµ¬ë‹ˆì— ë‹´ì•˜ìŠµë‹ˆë‹¤', 'success');
}, [cart, addNotification]);
```

### After: ê³„ì‚° ë¶„ë¦¬

```typescript
// models/cart.ts - ìˆœìˆ˜ í•¨ìˆ˜ (ê³„ì‚°)
export function canAddToCart(product: Product, cart: CartItem[]): boolean {
  const remaining = getRemainingStock(product, cart);
  return remaining > 0;
}

export function addItemToCart(cart: CartItem[], product: Product): CartItem[] {
  const existingItem = cart.find(item => item.product.id === product.id);
  
  if (existingItem) {
    return cart.map(item =>
      item.product.id === product.id
        ? { ...item, quantity: item.quantity + 1 }
        : item
    );
  }
  
  return [...cart, { product, quantity: 1 }];
}

export function getRemainingStock(product: Product, cart: CartItem[]): number {
  const cartItem = cart.find(item => item.product.id === product.id);
  return product.stock - (cartItem?.quantity || 0);
}
```

```typescript
// hooks/useCart.ts - ì•¡ì…˜ (í›…)
export function useCart() {
  const [cart, setCart] = useState<CartItem[]>([]);
  const { addNotification } = useNotification();
  
  const addToCart = useCallback((product: Product) => {
    // ê³„ì‚° í•¨ìˆ˜ ì‚¬ìš©
    if (!canAddToCart(product, cart)) {
      addNotification('ì¬ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!', 'error');
      return;
    }
    
    // ê³„ì‚° í•¨ìˆ˜ë¡œ ìƒˆ ì¹´íŠ¸ ìƒì„± í›„ ìƒíƒœ ì—…ë°ì´íŠ¸ (ì•¡ì…˜)
    setCart(prevCart => addItemToCart(prevCart, product));
    addNotification('ì¥ë°”êµ¬ë‹ˆì— ë‹´ì•˜ìŠµë‹ˆë‹¤', 'success');
  }, [cart, addNotification]);
  
  return { cart, addToCart };
}
```

---

## ğŸ“ ìˆœìˆ˜ í•¨ìˆ˜ ì‘ì„± ê·œì¹™

### 1. ëª¨ë“  ì…ë ¥ì€ íŒŒë¼ë¯¸í„°ë¡œ

```typescript
// âŒ ì™¸ë¶€ ë³€ìˆ˜ ì°¸ì¡°
const cart = [...]; // ì™¸ë¶€ ë³€ìˆ˜
function getTotal() {
  return cart.reduce((sum, item) => sum + item.price, 0);
}

// âœ… íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬
function getTotal(cart: CartItem[]) {
  return cart.reduce((sum, item) => sum + item.product.price, 0);
}
```

### 2. ë¶ˆë³€ì„± ìœ ì§€

```typescript
// âŒ ì›ë³¸ ìˆ˜ì •
function updateQuantity(cart: CartItem[], productId: string, qty: number) {
  const item = cart.find(i => i.product.id === productId);
  if (item) item.quantity = qty; // ì›ë³¸ ìˆ˜ì •!
  return cart;
}

// âœ… ìƒˆ ê°ì²´/ë°°ì—´ ë°˜í™˜
function updateQuantity(cart: CartItem[], productId: string, qty: number): CartItem[] {
  return cart.map(item =>
    item.product.id === productId
      ? { ...item, quantity: qty }
      : item
  );
}
```

### 3. ë¶€ì‘ìš© ì—†ìŒ

```typescript
// âŒ ë¶€ì‘ìš© í¬í•¨
function calculateTotal(cart: CartItem[]) {
  const total = cart.reduce((sum, item) => sum + item.product.price * item.quantity, 0);
  console.log('Total:', total); // ë¶€ì‘ìš©!
  return total;
}

// âœ… ìˆœìˆ˜í•˜ê²Œ ê³„ì‚°ë§Œ
function calculateTotal(cart: CartItem[]): number {
  return cart.reduce((sum, item) => sum + item.product.price * item.quantity, 0);
}
```

---

## ğŸ¯ ì´ ê³¼ì œì—ì„œì˜ ì ìš©

### ë¶„ë¦¬í•´ì•¼ í•  ìˆœìˆ˜ í•¨ìˆ˜ë“¤ (models/cart.ts)

| í•¨ìˆ˜ëª… | ì—­í•  |
|--------|------|
| `calculateItemTotal(item)` | ê°œë³„ ì•„ì´í…œ ì´ì•¡ (í• ì¸ ì ìš©) |
| `getMaxApplicableDiscount(item)` | ìµœëŒ€ ì ìš© ê°€ëŠ¥ í• ì¸ìœ¨ |
| `calculateCartTotal(cart, coupon)` | ì¥ë°”êµ¬ë‹ˆ ì´ì•¡ ê³„ì‚° |
| `addItemToCart(cart, product)` | ì•„ì´í…œ ì¶”ê°€ (ìƒˆ ë°°ì—´ ë°˜í™˜) |
| `removeItemFromCart(cart, productId)` | ì•„ì´í…œ ì œê±° (ìƒˆ ë°°ì—´ ë°˜í™˜) |
| `updateCartItemQuantity(cart, productId, qty)` | ìˆ˜ëŸ‰ ë³€ê²½ (ìƒˆ ë°°ì—´ ë°˜í™˜) |
| `getRemainingStock(product, cart)` | ë‚¨ì€ ì¬ê³  ê³„ì‚° |
| `canAddToCart(product, cart)` | ì¶”ê°€ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸ |

### ì•¡ì…˜ìœ¼ë¡œ ë‚¨ì„ ê²ƒë“¤ (hooks/useCart.ts)

| í•¨ìˆ˜ëª… | ì—­í•  |
|--------|------|
| `addToCart(product)` | ìƒíƒœ ì—…ë°ì´íŠ¸ + ì•Œë¦¼ |
| `removeFromCart(productId)` | ìƒíƒœ ì—…ë°ì´íŠ¸ |
| `updateQuantity(productId, qty)` | ìƒíƒœ ì—…ë°ì´íŠ¸ + ìœ íš¨ì„± ê²€ì‚¬ |
| `applyCoupon(coupon)` | ì¿ í° ìƒíƒœ ì—…ë°ì´íŠ¸ |
| `checkout()` | ì£¼ë¬¸ ì™„ë£Œ ì²˜ë¦¬ |

---

## ğŸ“š ì°¸ê³  ìë£Œ

- [ì™ì™ ë“¤ì–´ì˜¤ëŠ” í•¨ìˆ˜í˜• ì½”ë”©](http://www.yes24.com/Product/Goods/108748841) - Eric Normand
- ì´ ì±…ì—ì„œ "ì•¡ì…˜/ê³„ì‚°/ë°ì´í„°" ê°œë…ì„ ìƒì„¸íˆ ë‹¤ë£¹ë‹ˆë‹¤

