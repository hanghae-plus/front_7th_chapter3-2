# ê³¼ì œ êµ¬í˜„ ê°€ì´ë“œ

## ğŸ“š ê°œìš”

ì´ ë¬¸ì„œëŠ” ê¸°ë³¸ê³¼ì œì™€ ì‹¬í™”ê³¼ì œë¥¼ ë‹¨ê³„ë³„ë¡œ êµ¬í˜„í•˜ëŠ” ê°€ì´ë“œì…ë‹ˆë‹¤.

---

## ğŸ“ refactoring(hint) ë””ë ‰í† ë¦¬ ì°¸ê³ 

í”„ë¡œì íŠ¸ì— ì œê³µëœ `src/refactoring(hint)/` ë””ë ‰í† ë¦¬ëŠ” **ëª©í‘œ êµ¬ì¡°ì™€ íŒíŠ¸**ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

### íŒíŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
src/refactoring(hint)/
â”œâ”€â”€ App.tsx                 # ë©”ì¸ ì•± (ë¼ìš°íŒ…ë§Œ ë‹´ë‹¹)
â”œâ”€â”€ main.tsx
â”‚
â”œâ”€â”€ constants/
â”‚   â””â”€â”€ index.ts            # ì´ˆê¸° ë°ì´í„° (initialProducts, initialCoupons)
â”‚
â”œâ”€â”€ models/                 # ğŸ§® ìˆœìˆ˜ í•¨ìˆ˜ (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)
â”‚   â”œâ”€â”€ cart.ts             # ì¥ë°”êµ¬ë‹ˆ ê³„ì‚° í•¨ìˆ˜ë“¤
â”‚   â”œâ”€â”€ product.ts          # ìƒí’ˆ ê´€ë ¨ ìˆœìˆ˜ í•¨ìˆ˜
â”‚   â”œâ”€â”€ coupon.ts           # ì¿ í° ê´€ë ¨ ìˆœìˆ˜ í•¨ìˆ˜
â”‚   â””â”€â”€ discount.ts         # í• ì¸ ê³„ì‚° í•¨ìˆ˜
â”‚
â”œâ”€â”€ hooks/                  # âš¡ ì»¤ìŠ¤í…€ í›… (ìƒíƒœ ê´€ë¦¬)
â”‚   â”œâ”€â”€ useCart.ts          # ì¥ë°”êµ¬ë‹ˆ ìƒíƒœ + CRUD
â”‚   â”œâ”€â”€ useProducts.ts      # ìƒí’ˆ ìƒíƒœ + CRUD
â”‚   â””â”€â”€ useCoupons.ts       # ì¿ í° ìƒíƒœ + CRUD
â”‚
â”œâ”€â”€ utils/                  # ğŸ”§ ìœ í‹¸ë¦¬í‹°
â”‚   â”œâ”€â”€ formatters.ts       # í¬ë§·íŒ… í•¨ìˆ˜
â”‚   â”œâ”€â”€ validators.ts       # ê²€ì¦ í•¨ìˆ˜
â”‚   â””â”€â”€ hooks/
â”‚       â”œâ”€â”€ useDebounce.ts  # ë””ë°”ìš´ìŠ¤ í›…
â”‚       â”œâ”€â”€ useLocalStorage.ts  # localStorage ë™ê¸°í™” í›…
â”‚       â””â”€â”€ useValidate.ts  # ìœ íš¨ì„± ê²€ì‚¬ í›…
â”‚
â””â”€â”€ components/             # ğŸ¨ UI ì»´í¬ë„ŒíŠ¸
    â”œâ”€â”€ AdminPage.tsx       # ê´€ë¦¬ì í˜ì´ì§€
    â”œâ”€â”€ CartPage.tsx        # ì¥ë°”êµ¬ë‹ˆ/ì‡¼í•‘ í˜ì´ì§€
    â”œâ”€â”€ icons/
    â”‚   â””â”€â”€ index.tsx       # SVG ì•„ì´ì½˜ ì»´í¬ë„ŒíŠ¸ë“¤
    â””â”€â”€ ui/
        â””â”€â”€ UIToast.ts      # í† ìŠ¤íŠ¸ ì•Œë¦¼ ì»´í¬ë„ŒíŠ¸
```

### ê° íŒŒì¼ë³„ êµ¬í˜„ íŒíŠ¸

#### ğŸ“¦ models/ (ìˆœìˆ˜ í•¨ìˆ˜)

**`models/cart.ts`**
```
êµ¬í˜„í•  í•¨ìˆ˜:
- calculateItemTotal(item): ê°œë³„ ì•„ì´í…œ í• ì¸ ì ìš© í›„ ì´ì•¡
- getMaxApplicableDiscount(item): ì ìš© ê°€ëŠ¥í•œ ìµœëŒ€ í• ì¸ìœ¨
- calculateCartTotal(cart, coupon): ì¥ë°”êµ¬ë‹ˆ ì´ì•¡ (í• ì¸ ì „/í›„)
- updateCartItemQuantity(cart, productId, quantity): ìˆ˜ëŸ‰ ë³€ê²½
- addItemToCart(cart, product): ìƒí’ˆ ì¶”ê°€
- removeItemFromCart(cart, productId): ìƒí’ˆ ì œê±°
- getRemainingStock(product, cart): ë‚¨ì€ ì¬ê³  ê³„ì‚°

ì›ì¹™:
- UI ê´€ë ¨ ë¡œì§ ì—†ìŒ
- ì™¸ë¶€ ìƒíƒœì— ì˜ì¡´í•˜ì§€ ì•ŠìŒ
- ëª¨ë“  í•„ìš”í•œ ë°ì´í„°ëŠ” íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬
```

#### âš¡ hooks/ (ì»¤ìŠ¤í…€ í›…)

**`hooks/useCart.ts`**
```
ë°˜í™˜í•  ê°’:
- cart: ì¥ë°”êµ¬ë‹ˆ ì•„ì´í…œ ë°°ì—´
- selectedCoupon: ì„ íƒëœ ì¿ í°
- addToCart: ìƒí’ˆ ì¶”ê°€ í•¨ìˆ˜
- removeFromCart: ìƒí’ˆ ì œê±° í•¨ìˆ˜
- updateQuantity: ìˆ˜ëŸ‰ ë³€ê²½ í•¨ìˆ˜
- applyCoupon: ì¿ í° ì ìš© í•¨ìˆ˜
- calculateTotal: ì´ì•¡ ê³„ì‚° í•¨ìˆ˜
- getRemainingStock: ì¬ê³  í™•ì¸ í•¨ìˆ˜
- clearCart: ì¥ë°”êµ¬ë‹ˆ ë¹„ìš°ê¸° í•¨ìˆ˜

ì‚¬ìš©í•  ëª¨ë¸ í•¨ìˆ˜: cartModel.addItemToCart, cartModel.removeItemFromCart ë“±
```

**`hooks/useProducts.ts`**
```
ë°˜í™˜í•  ê°’:
- products: ìƒí’ˆ ë°°ì—´
- updateProduct: ìƒí’ˆ ì •ë³´ ìˆ˜ì •
- addProduct: ìƒˆ ìƒí’ˆ ì¶”ê°€
- updateProductStock: ì¬ê³  ìˆ˜ì •
- addProductDiscount: í• ì¸ ê·œì¹™ ì¶”ê°€
- removeProductDiscount: í• ì¸ ê·œì¹™ ì‚­ì œ
```

**`hooks/useCoupons.ts`**
```
ë°˜í™˜í•  ê°’:
- coupons: ì¿ í° ë°°ì—´
- addCoupon: ìƒˆ ì¿ í° ì¶”ê°€
- removeCoupon: ì¿ í° ì‚­ì œ
```

#### ğŸ”§ utils/ (ìœ í‹¸ë¦¬í‹°)

**`utils/formatters.ts`**
```
êµ¬í˜„í•  í•¨ìˆ˜:
- formatPrice(price: number): string - ê°€ê²©ì„ ì›í™” í˜•ì‹ìœ¼ë¡œ
- formatDate(date: Date): string - YYYY-MM-DD í˜•ì‹
- formatPercentage(rate: number): string - ì†Œìˆ˜ë¥¼ í¼ì„¼íŠ¸ë¡œ (0.1 â†’ 10%)
```

**`utils/validators.ts`**
```
êµ¬í˜„í•  í•¨ìˆ˜:
- isValidCouponCode(code): boolean - ì¿ í° ì½”ë“œ í˜•ì‹ ê²€ì¦
- isValidStock(stock): boolean - ì¬ê³  ìˆ˜ëŸ‰ ê²€ì¦ (0 ì´ìƒ)
- isValidPrice(price): boolean - ê°€ê²© ê²€ì¦ (ì–‘ìˆ˜)
- extractNumbers(value): string - ë¬¸ìì—´ì—ì„œ ìˆ«ìë§Œ ì¶”ì¶œ
```

**`utils/hooks/useDebounce.ts`**
```
- ê°’ì´ ë³€ê²½ë˜ì–´ë„ ì§€ì •ëœ ì‹œê°„ ë™ì•ˆ ëŒ€ê¸°
- ëŒ€ê¸° ì‹œê°„ ë™ì•ˆ ê°’ì´ ë‹¤ì‹œ ë³€ê²½ë˜ë©´ íƒ€ì´ë¨¸ ë¦¬ì…‹
- ìµœì¢…ì ìœ¼ë¡œ ì•ˆì •ëœ ê°’ë§Œ ë°˜í™˜
```

**`utils/hooks/useLocalStorage.ts`**
```
- localStorageì™€ React state ë™ê¸°í™”
- ì´ˆê¸°ê°’ ë¡œë“œ ì‹œ ì—ëŸ¬ ì²˜ë¦¬
- ì €ì¥ ì‹œ JSON ì§ë ¬í™”/ì—­ì§ë ¬í™”
- ë¹ˆ ë°°ì—´ì´ë‚˜ undefinedëŠ” ì‚­ì œ
```

#### ğŸ¨ components/ (UI)

**`components/CartPage.tsx`**
```
í•„ìš”í•œ hooks: useProducts, useCart, useCoupons, useDebounce

í•˜ìœ„ ì»´í¬ë„ŒíŠ¸:
- SearchBar: ê²€ìƒ‰ ì…ë ¥
- ProductList: ìƒí’ˆ ëª©ë¡ í‘œì‹œ
- Cart: ì¥ë°”êµ¬ë‹ˆ í‘œì‹œ ë° ê²°ì œ
```

**`components/AdminPage.tsx`**
```
í•„ìš”í•œ hooks: useProducts, useCoupons

í•˜ìœ„ ì»´í¬ë„ŒíŠ¸:
- ProductForm: ìƒˆ ìƒí’ˆ ì¶”ê°€ í¼
- ProductAccordion: ìƒí’ˆ ì •ë³´ í‘œì‹œ ë° ìˆ˜ì •
- CouponForm: ìƒˆ ì¿ í° ì¶”ê°€ í¼
- CouponList: ì¿ í° ëª©ë¡ í‘œì‹œ
```

**`components/icons/index.tsx`**
```
êµ¬í˜„í•  ì•„ì´ì½˜: CartIcon, AdminIcon, PlusIcon, MinusIcon, 
              TrashIcon, ChevronDownIcon, ChevronUpIcon, CheckIcon
```

---

## ğŸ¯ ê¸°ë³¸ê³¼ì œ êµ¬í˜„ ìˆœì„œ

### Step 1: í´ë” êµ¬ì¡° ìƒì„±

```bash
src/basic/
â”œâ”€â”€ models/           # ìˆœìˆ˜ í•¨ìˆ˜
â”‚   â”œâ”€â”€ cart.ts
â”‚   â”œâ”€â”€ product.ts
â”‚   â””â”€â”€ coupon.ts
â”œâ”€â”€ hooks/            # ì»¤ìŠ¤í…€ í›…
â”‚   â”œâ”€â”€ useCart.ts
â”‚   â”œâ”€â”€ useProducts.ts
â”‚   â”œâ”€â”€ useCoupons.ts
â”‚   â””â”€â”€ useNotification.ts
â”œâ”€â”€ utils/            # ìœ í‹¸ë¦¬í‹°
â”‚   â”œâ”€â”€ formatters.ts
â”‚   â””â”€â”€ hooks/
â”‚       â””â”€â”€ useDebounce.ts
â”œâ”€â”€ components/       # UI ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ Cart/
â”‚   â”œâ”€â”€ Product/
â”‚   â””â”€â”€ Admin/
â””â”€â”€ App.tsx
```

### Step 2: ìˆœìˆ˜ í•¨ìˆ˜ ë¶„ë¦¬ (models/cart.ts)

```typescript
// models/cart.ts
import { CartItem, Product, Coupon } from '../types';

export function getMaxApplicableDiscount(item: CartItem): number {
  const { discounts } = item.product;
  const { quantity } = item;
  
  return discounts.reduce((maxDiscount, discount) => {
    return quantity >= discount.quantity && discount.rate > maxDiscount 
      ? discount.rate 
      : maxDiscount;
  }, 0);
}

export function calculateItemTotal(item: CartItem): number {
  const { price } = item.product;
  const { quantity } = item;
  const discount = getMaxApplicableDiscount(item);
  
  return Math.round(price * quantity * (1 - discount));
}

export function calculateCartTotal(
  cart: CartItem[], 
  selectedCoupon: Coupon | null
): { totalBeforeDiscount: number; totalAfterDiscount: number } {
  const totalBeforeDiscount = cart.reduce(
    (sum, item) => sum + item.product.price * item.quantity, 
    0
  );
  
  let totalAfterDiscount = cart.reduce(
    (sum, item) => sum + calculateItemTotal(item), 
    0
  );
  
  if (selectedCoupon) {
    if (selectedCoupon.discountType === 'amount') {
      totalAfterDiscount = Math.max(0, totalAfterDiscount - selectedCoupon.discountValue);
    } else {
      totalAfterDiscount = Math.round(
        totalAfterDiscount * (1 - selectedCoupon.discountValue / 100)
      );
    }
  }
  
  return {
    totalBeforeDiscount: Math.round(totalBeforeDiscount),
    totalAfterDiscount: Math.round(totalAfterDiscount)
  };
}

export function addItemToCart(cart: CartItem[], product: Product): CartItem[] {
  const existingItem = cart.find(item => item.product.id === product.id);
  
  if (existingItem) {
    return cart.map(item =>
      item.product.id === product.id
        ? { ...item, quantity: item.quantity + 1 }
        : item
    );
  }
  
  return [...cart, { product, quantity: 1 }];
}

export function removeItemFromCart(cart: CartItem[], productId: string): CartItem[] {
  return cart.filter(item => item.product.id !== productId);
}

export function updateCartItemQuantity(
  cart: CartItem[], 
  productId: string, 
  quantity: number
): CartItem[] {
  if (quantity <= 0) {
    return removeItemFromCart(cart, productId);
  }
  
  return cart.map(item =>
    item.product.id === productId
      ? { ...item, quantity }
      : item
  );
}

export function getRemainingStock(product: Product, cart: CartItem[]): number {
  const cartItem = cart.find(item => item.product.id === product.id);
  return product.stock - (cartItem?.quantity || 0);
}
```

### Step 3: ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ (utils/formatters.ts)

```typescript
// utils/formatters.ts
export function formatPrice(price: number): string {
  return `â‚©${price.toLocaleString()}`;
}

export function formatPriceKorean(price: number): string {
  return `${price.toLocaleString()}ì›`;
}

export function formatPercentage(rate: number): string {
  return `${Math.round(rate * 100)}%`;
}

export function formatDate(date: Date): string {
  return date.toISOString().split('T')[0];
}
```

### Step 4: ìœ í‹¸ë¦¬í‹° í›… (utils/hooks/useDebounce.ts)

```typescript
// utils/hooks/useDebounce.ts
import { useState, useEffect } from 'react';

export function useDebounce<T>(value: T, delay: number): T {
  const [debouncedValue, setDebouncedValue] = useState<T>(value);
  
  useEffect(() => {
    const timer = setTimeout(() => {
      setDebouncedValue(value);
    }, delay);
    
    return () => clearTimeout(timer);
  }, [value, delay]);
  
  return debouncedValue;
}
```

### Step 5: ë„ë©”ì¸ í›… ìƒì„± (hooks/useCart.ts)

hooks í´ë”ì— useCart, useProducts, useCoupons í›…ì„ ìƒì„±í•©ë‹ˆë‹¤.
(ìƒì„¸ êµ¬í˜„ì€ 03-React-Hook-íŒ¨í„´.md ì°¸ì¡°)

### Step 6: App.tsx ë¦¬íŒ©í† ë§

```tsx
// App.tsx - ë¦¬íŒ©í† ë§ í›„
import { useCart } from './hooks/useCart';
import { useProducts } from './hooks/useProducts';
import { useCoupons } from './hooks/useCoupons';
import { useNotification } from './hooks/useNotification';
import { useDebounce } from './utils/hooks/useDebounce';

function App() {
  // ë„ë©”ì¸ í›… ì‚¬ìš©
  const { 
    cart, selectedCoupon, totals, totalItemCount,
    addToCart, removeFromCart, updateQuantity, 
    applyCoupon, clearCart, getRemainingStock 
  } = useCart();
  
  const { products, addProduct, updateProduct, deleteProduct } = useProducts();
  const { coupons, addCoupon, deleteCoupon } = useCoupons();
  const { notifications, addNotification, removeNotification } = useNotification();
  
  // UI ìƒíƒœ
  const [isAdmin, setIsAdmin] = useState(false);
  const [searchTerm, setSearchTerm] = useState('');
  const debouncedSearchTerm = useDebounce(searchTerm, 500);
  
  // í•„í„°ë§ëœ ìƒí’ˆ
  const filteredProducts = useMemo(() => {
    if (!debouncedSearchTerm) return products;
    return products.filter(p => 
      p.name.toLowerCase().includes(debouncedSearchTerm.toLowerCase())
    );
  }, [products, debouncedSearchTerm]);
  
  // í•¸ë“¤ëŸ¬
  const handleAddToCart = (product: Product) => {
    const result = addToCart(product);
    addNotification(result.message, result.success ? 'success' : 'error');
  };
  
  return (
    <div className="min-h-screen bg-gray-50">
      {/* ì•Œë¦¼ */}
      {/* í—¤ë” */}
      {/* ë©”ì¸ ì»¨í…ì¸  */}
    </div>
  );
}
```

---

## ğŸš€ ì‹¬í™”ê³¼ì œ êµ¬í˜„ ìˆœì„œ

### Step 1: Context ë˜ëŠ” Jotai ì„ íƒ

ê¸°ë³¸ê³¼ì œ ì™„ë£Œ í›„, ì „ì—­ ìƒíƒœ ê´€ë¦¬ ë°©ì‹ì„ ì„ íƒí•©ë‹ˆë‹¤.

### Step 2: ì „ì—­ ìƒíƒœ ì„¤ì •

**Context ë°©ì‹:**
```typescript
// context/CartContext.tsx
// context/ProductContext.tsx  
// context/CouponContext.tsx
// context/index.tsx (Provider ì¡°í•©)
```

**Jotai ë°©ì‹:**
```typescript
// store/cartAtoms.ts
// store/productAtoms.ts
// store/couponAtoms.ts
```

### Step 3: Props Drilling ì œê±°

**Before:**
```tsx
<ProductList
  products={products}
  cart={cart}
  onAddToCart={handleAddToCart}
  getRemainingStock={getRemainingStock}
/>
```

**After (Context):**
```tsx
<ProductList products={products} />

// ProductList ë‚´ë¶€ì—ì„œ
const { addToCart, getRemainingStock } = useCartContext();
```

**After (Jotai):**
```tsx
<ProductList products={products} />

// ProductList ë‚´ë¶€ì—ì„œ
const addToCart = useSetAtom(addToCartAtom);
const getRemainingStock = useAtomValue(getRemainingStockAtom);
```

### Step 4: Compound Components ì ìš© (ì„ íƒ)

```tsx
// ê¸°ì¡´
<CartSection
  cart={cart}
  totals={totals}
  coupons={coupons}
  selectedCoupon={selectedCoupon}
  onUpdateQuantity={updateQuantity}
  onRemove={removeFromCart}
  onApplyCoupon={applyCoupon}
  onCheckout={checkout}
/>

// Compound Components
<Cart>
  <Cart.Header />
  <Cart.ItemList />
  <Cart.CouponSelector coupons={coupons} />
  <Cart.Summary />
  <Cart.CheckoutButton />
</Cart>
```

---

## âœ… ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸

### ê¸°ë³¸ê³¼ì œ

- [ ] `models/cart.ts`ì— ìˆœìˆ˜ í•¨ìˆ˜ë“¤ì´ ë¶„ë¦¬ë¨
- [ ] `utils/formatters.ts`ì— í¬ë§· í•¨ìˆ˜ë“¤ì´ ë¶„ë¦¬ë¨
- [ ] `utils/hooks/useDebounce.ts` êµ¬í˜„ë¨
- [ ] `hooks/useCart.ts` - ì¥ë°”êµ¬ë‹ˆ í›… êµ¬í˜„ë¨
- [ ] `hooks/useProducts.ts` - ìƒí’ˆ í›… êµ¬í˜„ë¨
- [ ] `hooks/useCoupons.ts` - ì¿ í° í›… êµ¬í˜„ë¨
- [ ] App.tsxê°€ í›…ì„ ì‚¬ìš©í•˜ë„ë¡ ë¦¬íŒ©í† ë§ë¨
- [ ] ìˆœìˆ˜ í•¨ìˆ˜ê°€ ì™¸ë¶€ ìƒíƒœì— ì˜ì¡´í•˜ì§€ ì•ŠìŒ
- [ ] ê³„ì¸µ êµ¬ì¡°(models â†’ hooks â†’ components)ê°€ ì§€ì¼œì§

### ì‹¬í™”ê³¼ì œ

- [ ] Context ë˜ëŠ” Jotaië¡œ ì „ì—­ ìƒíƒœ ê´€ë¦¬ êµ¬í˜„ë¨
- [ ] ë¶ˆí•„ìš”í•œ props drillingì´ ì œê±°ë¨
- [ ] ë„ë©”ì¸ ë°ì´í„° propsëŠ” ìœ ì§€ë¨
- [ ] ì»´í¬ë„ŒíŠ¸ ê²°í•©ë„ê°€ ë‚®ì•„ì§
- [ ] í…ŒìŠ¤íŠ¸ê°€ í†µê³¼í•¨

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹¤í–‰

```bash
# ê¸°ë³¸ê³¼ì œ í…ŒìŠ¤íŠ¸
npm run test:basic

# ì‹¬í™”ê³¼ì œ í…ŒìŠ¤íŠ¸
npm run test:advanced
```

---

## ğŸ“š ì°¸ê³  ë¬¸ì„œ

1. [01-í•¨ìˆ˜í˜•-í”„ë¡œê·¸ë˜ë°-ê¸°ì´ˆ.md](./01-í•¨ìˆ˜í˜•-í”„ë¡œê·¸ë˜ë°-ê¸°ì´ˆ.md)
2. [02-ì—”í‹°í‹°ì™€-ê³„ì¸µ-êµ¬ì¡°.md](./02-ì—”í‹°í‹°ì™€-ê³„ì¸µ-êµ¬ì¡°.md)
3. [03-React-Hook-íŒ¨í„´.md](./03-React-Hook-íŒ¨í„´.md)
4. [04-Compound-Components-íŒ¨í„´.md](./04-Compound-Components-íŒ¨í„´.md)
5. [05-ì „ì—­ìƒíƒœê´€ë¦¬-Context-vs-Jotai.md](./05-ì „ì—­ìƒíƒœê´€ë¦¬-Context-vs-Jotai.md)

